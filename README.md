# CP Interpreter

## TODO
- [X] Add load file from param
- [X] Rewrite the lexer
- [X] Rewrite EBNF
- [X] Change expression evaluation to left to right
- [X] Add and precedence
- [X] Add void support to function
- [X] Add void return
- [X] Add mod (%) operation support
- [X] Add library support
- [X] Add collum on errors
- [X] Add 'this' token to get current function name
- [X] Add const support
- [X] Add char type
- [X] Add any type
- [X] Add array type
  - [X] Make array accessor accepts expression
- [X] Add struct support
    - [X] Add struct array-like constructor
    - [X] Add Java class pointer-like behavior
    - [ ] Add struct as Dict by iterating over in foreach
- [X] Add null support
- [X] Add type convert support
    - [X] Add array and struct support (based on print)
- [X] Remove mandatory variable type definition
- [X] Improve cp dependencies/libs loader
- [X] Add string array-like accessor
- [ ] Function improvements:
    - [X] Pass parameter by reference
    - [X] Change builtin functions to ASTFunctionDefinitionNode
    - [X] Add callback as type function
    - [X] Add rest parameters, like `def foo(...args: any)`
    - [X] Add optional parameters `def foo(arg: any = 10)`
    - [ ] Add arrow function `(arg): void {}`, `(arg) {}`, `() {}`
- [X] Add built in funcs:
    - [X] print:
        - [X] Improve to accept multiple values
    - [X] read:
        - [X] Improve to accept prompt
    - [X] len: returns size of array/string
    - [X] readch: read 1 single char
    - [X] equals: compare values, if struct, compare struct values and not struct pointer
    - [X] system: execute systems commands
- [X] Add statements:
    - [X] for
    - [X] foreach
    - [X] else if
    - [X] switch
    - [X] break
    - [X] continue
    - [X] +=,-=,*=,/=,%= assignment
    - [X] namespace
    - [X] as namespace
    - [X] exit
    - [X] enum
    - [X] try catch throw
        - [X] Bring error header to a higher level
        - [X] add ... to ignore catch error
    - [X] do while
- [ ] Add expression:
    - [X] Add expression operators:
        - [X] Add ++,-- incrementor
        - [X] Add { init_value } to initilize all positions with same value
        - [X] Add 'in' operator to check if anything is in array/string
            - [X] Add $ operator to compare struct values instead of pointer
        - [X] Add ternary (immediate) if
        - [X] typeof: returns type of object
            - [X] add namespace to type name return
        - [X] typeid: returns hash of typeof
        - [ ] add bitwise operators:
            - [ ] &   bitwise AND
            - [ ] |   bitwise inclusive OR
            - [ ] ^   bitwise XOR (exclusive OR)
            - [ ] <<  left shift
            - [ ] >>  right shift
            - [ ] ~	  bitwise NOT (ones' complement) (unary)
    - [ ] Add expression literal:
        - [ ] base literals:
            - [ ] bin
            - [ ] oct
            - [ ] dec
            - [ ] hex
- [X] Let functions return array
- [X] Add namespace scope nmspace::(method|variable|struct)
- [X] Guanrantee that a lib is loaded once
- [X] Flex function return, remove mandatory type definition in return
- [X] Remove struct as bool in expression and change this type of verification to void value comparation (eg: var == null)
- [X] Move function body parser to caller node (as interpreter), to check parameters of each caller
- [ ] Improve error system (based on C++)
- [ ] Improve REPL:
    - [ ] Now expressions can be executed in statements, dont need more to execute expression parser directly
- [X] Add a default interface to implements built in functions
- [X] Add a default interface to implements core libs
- [ ] General otimizations:
    - [ ] Remove duplicate codes
        - [ ] Organize semantic duplicated checks
    - [ ] Implement detructors
    - [X] Move some verifications to semantic analisys:
        - [X] Array size check from interpreter
- [ ] Projects to implement in CP:
    - [ ] https://github.com/drmenguin/minilang-interpreter
    - [ ] https://github.com/univesity-projects/sort-algorithms
    - [ ] https://github.com/univesity-projects/caesar-cipher
    - [ ] https://github.com/univesity-projects/pong-pro-player
    - [ ] https://github.com/carlosebmachado-games/tetris-Clone
- [ ] Add core library:
    - [X] File I/O
    - [ ] Time
    - [X] Graphics
    - [ ] Keyboard
    - [ ] Mouse
    - [ ] Sound
    - [X] Exception
    - [X] Console:
        - [X] Set caret position
        - [X] Change color
        - [X] Set font
    - [ ] Web/API
- [ ] Add CP library:
    - [ ] JSON (use Dict)
        - [ ] struct to json
        - [ ] json_stringfy
        - [ ] json_parse
    - [ ] String
        - [ ] size: size of string
        - [ ] contains: string is contained in other string
        - [ ] ends_with, starts_with: string is contained in extremities
        - [ ] substring: returns substring
        - [ ] replace: replace substrinf for another
        - [ ] to_lower, to_upper: capitalize, uncapitalize
        - [ ] to_string: value to string
        - [ ] split: split string in array
        - [ ] join: merge array values in string
        - [ ] left_trim, right_trim, trim: removes whitespaces strings
    - [ ] Array:
        - [ ] size: size of array
        - [ ] contains: value is contained in array
        - [ ] sorted: sort a list
        - [ ] reversed: reverse a list
    - [ ] Math
        - [X] abs: ret absolute value of a number
        - [X] max: return greather from two or more parameters
        - [X] min: return lesser from two or more parameters
        - [X] sum: sum all items from array
        - [X] round: round a float number
        - [X] hash: returns hash of string
    - [X] Random (https://docs.godotengine.org/en/stable/classes/class_randomnumbergenerator.html):
        - [X] randi(from: int, to: int): int
        - [X] seed(seed: int)
        - [X] ...
    - [ ] Collections
        - [ ] List
        - [ ] Queue
        - [ ] Stack
        - [ ] Dict
    - [ ] Util?

## Known bugs
- [X] When a struct is passed by parameter, it can't be assigned as null, it occours because it's passed just the strcut reference and not the variable
- [X] Can't assing string position
- [X] Parser can't handle unary assign operators when its inside a expression, as declaration expression its work (eg print(i++))
- [X] This does not always return the expected value, eg when its inside a function tha does not has in main file

## Errors
- Errors has CP prefix, eg. CP9999
- Token errors init with 1
- Lexer errors init with 2
- Semantic scope errors init with 3
- Semantic analyser errors init with 4
- Interpreter scope errors init with 5
- Interpreter errors init with 6

## Rules

### Arrays
- If an array has your size defined in declaration, it can just assigned and reassigned with a same size and dimension array expression.

### Types
- If an variable is not defined, it's undef, and it can be initialized with null or a value.
- Variable has a type, if it is defined, it is fixed, else it will be any and the type can change.
- If a variable is not an array, it can not be assined, even if it be any.
